# NOTE(ssd) 2019-02-06: Please explicitly document why a given job is
# here and not in the public verify pipeline. The more jobs we have in
# this pipeline, the harder it is for external contributors.

expeditor:
  defaults:
    executor:
      docker:
        workdir: /go/src/github.com/chef/automate

steps: 
  - label: "cypress :cypress:"
    command:
      - FLAKY=no integration/run_test integration/tests/cypress_e2e.sh
    timeout_in_minutes: 45
    retry:
      automatic:
        limit: 2
    expeditor:
      secrets: &cypress_secrets
        A2_LICENSE:
          path: secret/a2/license
          field: license
        CYPRESS_AUTOMATE_ACCEPTANCE_TARGET_HOST:
          path: secret/a2/testing/target_host
          field: data
        CYPRESS_AUTOMATE_ACCEPTANCE_TARGET_USER:
          path: secret/a2/testing/target_user
          field: data
        CYPRESS_AUTOMATE_ACCEPTANCE_TARGET_KEY:
          path: secret/a2/testing/target_key
          field: data
        CYPRESS_AUTOMATE_INFRA_ADMIN_KEY:
          path: secret/a2/testing/infra_admin_key
          field: data
      executor:
        linux:
          privileged: true

